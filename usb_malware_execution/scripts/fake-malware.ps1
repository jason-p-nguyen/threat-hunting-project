<#
.SYNOPSIS
    Simulated malware payload for threat hunting lab: USB Malware Execution (https://github.com/jason-p-nguyen/threat-hunting-projects/tree/main/usb_malware_execution).
.DESCRIPTION
    This script mimics common attacker behaviors like beaconing, data exfiltration, persistence, and recon.
    It does NOT perform real malicious actions.
#>

Write-Output "`n[*] Connecting to Command & Control server..."
Start-Sleep -Seconds 2
Write-Output "[+] Beacon sent to https://attacker.example.com/api/beacon?id=HOST123"

Write-Output "`n[*] Collecting system info..."
$sysInfo = Get-ComputerInfo | Select-Object CsName, WindowsProductName, OsArchitecture, OsBuildNumber
$sysInfo | Format-Table | Out-String | Write-Output
Start-Sleep -Seconds 2

Write-Output "`n[*] Simulating credential scraping..."
$fakeCreds = @{
    "user1@company.com" = "hunter2!"
    "admin@company.com" = "P@ssw0rd123"
}
$fakeCreds.GetEnumerator() | ForEach-Object {
    Write-Output "  - $_"
}
Start-Sleep -Seconds 2

Write-Output "`n[*] Simulating data exfiltration to cloud bucket..."
Start-Sleep -Seconds 2
Write-Output "[+] Uploaded C:\Users\Public\Confidential\Employee_Record_Dump.csv to S3 bucket"

Write-Output "`n[*] Establishing persistence using Task Scheduler..."
$taskName = "SystemUpdater"
$payloadPath = "C:\Temp\payload.ps1"
schtasks /create /tn $taskName /tr "powershell.exe -ExecutionPolicy Bypass -File `"$payloadPath`"" /sc minute /mo 30 /f
Write-Output "[+] Task '$taskName' created to re-run payload every 30 minutes."

Write-Output "`n[!] Simulation complete. This was a fake payload for training purposes only."
